# ETF投资组合回测系统

纯前端的交互式ETF投资组合回测工具，支持自定义权重配置、多种再平衡策略和实时结果分析。

---

## 快速开始

### 启动回测工具

由于工具需要加载本地CSV数据文件，需要从项目根目录启动HTTP服务器：

```bash
cd /path/to/investment_research
python -m http.server 8000
```

然后在浏览器中打开：
```
http://localhost:8000/etf_reblance/backtest_interactive.html
```

---

## 功能特性

### 投资配置
- 支持5种指数资产的自定义权重配置
  - 纳斯达克100
  - 标普500
  - 中证红利低波100
  - 自由现金流指数
  - 证金债指数
- 权重实时验证（总和必须等于100%）

### 回测参数
- 初始资金设置
- 自定义日期范围
- 定投年限配置

### 再平衡策略
- **不再平衡**: Buy and Hold策略
- **定期再平衡**: 每N个月自动再平衡
- **阈值触发再平衡**: 当资产偏离目标权重超过阈值时触发

### 结果分析
- 核心指标展示：总收益率、年化收益率、最大回撤、夏普比率、索提诺比率
- 净值走势图表
- 收益率走势图表
- 各资产详细表现
- 再平衡记录

### 其他功能
- 历史记录保存（本地存储，最多20条）
- CSV导出功能
- 响应式设计

---

## 文件结构

```
etf_reblance/
├── backtest_interactive.html    # 主要回测工具（纯前端）
├── README.md                    # 本文档
└── ../data/processed/           # 指数数据文件
    ├── nasdaq100_normalized.csv
    ├── sp500_normalized.csv
    ├── 930955_normalized.csv
    ├── 980092_normalized.csv
    └── CNB00003_normalized.csv
```

---

## 技术架构

### 前端模块化设计

代码采用模块化架构，便于维护和扩展：

| 模块 | 职责 |
|------|------|
| `Config` | 资产配置和全局常量 |
| `State` | 应用状态管理 |
| `DataLoader` | CSV数据加载和缓存 |
| `BacktestEngine` | 核心回测计算逻辑 |
| `MetricsCalculator` | 性能指标计算 |
| `UIController` | UI渲染和交互 |
| `HistoryManager` | 历史记录管理 |
| `ExportManager` | 数据导出功能 |

### 依赖库

- [Chart.js 4.4.0](https://www.chartjs.org/) - 图表绘制
- [Papa Parse 5.4.1](https://www.papaparse.com/) - CSV解析

---

## 核心概念

### 夏普比率
- **公式**: (年化收益 - 无风险利率) / 年化波动率
- **意义**: 每承受1单位总风险，能获得多少超额收益
- **参考值**: > 0.5 优秀，> 1.0 极佳

### 索提诺比率
- **公式**: (年化收益 - 无风险利率) / 下行波动率
- **意义**: 只考虑下跌风险，比夏普比率更关注亏损
- **特点**: 通常比夏普比率高20-30%

### 相对阈值再平衡
- 不同权重资产使用不同的绝对阈值
- 例如：20%相对阈值
  - 40%资产: 触发阈值 = 40% × 20% = 8%（32%-48%触发）
  - 20%资产: 触发阈值 = 20% × 20% = 4%（16%-24%触发）

---

## 数据更新

如需更新指数数据，可使用项目根目录的数据下载脚本：

```bash
cd ..
python download_index_data.py
```

---

## 注意事项

1. **历史业绩不代表未来**: 回测结果仅供参考
2. **实际投资考虑**: 交易成本、税费、滑点、汇率等因素
3. **数据时效**: 请确保使用最新的指数数据

---

## 相关文件

- `../download_index_data.py` - 美股指数数据下载
- `../preprocessing/` - 数据预处理脚本
